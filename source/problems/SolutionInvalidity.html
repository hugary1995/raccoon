<!DOCTYPE html><head><meta charset="UTF-8"><title>SolutionInvalidity | RACCOON</title><link rel="icon" type="image/x-icon" href="../../media/raccoon_icon.png" sizes="16x16 32x32 64x64 128x128"></link><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">RACCOON</a><a href="https://github.com/hugary1995/raccoon" class="right"><img src="../../media/framework/github-logo.png" alt="GitHub wordmark" class="github-mark"></img><img src="../../media/framework/github-mark.png" alt="GitHub logo" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="4bf8721a-31fe-4ab8-b3ef-9ccfa39d5d3d" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="4c6e1d2a-6a82-40ec-86ad-66836fd4199c" data-constrainWidth="false">Tutorials<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="0f5ee1f3-d866-45ff-978d-64a0215eea29" data-constrainWidth="false">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="f5c5e5f6-2738-43b5-99b9-114089fd6e35" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../contribute/index.html">Contribute</a></li></ul><a href="#" class="sidenav-trigger" data-target="19f05508-1dd2-4870-88cf-e0402fa222f5"><i class="material-icons">menu</i></a><ul class="sidenav" id="19f05508-1dd2-4870-88cf-e0402fa222f5"><li><a href="#!" class="dropdown-trigger" data-target="ae65570d-c2d6-4e4d-8147-88ea593035f0" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="9d316d28-3a66-4326-8e60-95f7e37a6527" data-constrainWidth="false">Tutorials<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="1c8549a2-bd3c-400c-bb4d-5f9bd4b5becb" data-constrainWidth="false">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="3992da72-b12f-46e5-bc1f-4840ad2bc679" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../contribute/index.html">Contribute</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="4bf8721a-31fe-4ab8-b3ef-9ccfa39d5d3d"><li><a href="../../getting_started/install.html">Install RACCOON</a></li><li><a href="../../getting_started/update.html">Update RACCOON</a></li><li><a href="../../getting_started/running.html">Running your first model</a></li><li><a href="../../getting_started/paraview.html">Visualization</a></li><li><a href="../../getting_started/ide.html">Code development</a></li><li><a href="../../getting_started/docs.html">Browse the documentation locally</a></li></ul><ul class="dropdown-content" id="4c6e1d2a-6a82-40ec-86ad-66836fd4199c"><li><a href="../../tutorials/01_small_deformation_elasticity.html">1. Small deformation</a></li><li><a href="../../tutorials/02_mode1_brittle_fracture.html">2. Mode-I fracture</a></li><li><a href="../../tutorials/03_mode2_brittle_fracture.html">3. Mode-II fracture</a></li><li><a href="../../tutorials/04_fiber_reinforced_matrix.html">4. Fiber-reinforced matrix</a></li><li><a href="../../tutorials/05_soil_desiccation.html">5. Soil desiccation</a></li><li><a href="../../tutorials/06_large_deformation_elasticity.html">6. Large deformation</a></li><li><a href="../../tutorials/07_elastoplasticity.html">7. Elastoplasticity</a></li><li><a href="../../tutorials/08_ductile_fracture.html">8. Ductile fracture</a></li><li><a href="../../tutorials/09_three_point_bending.html">9. Three-point bending</a></li><li><a href="../../tutorials/10_quenching_bibeam.html">10. Quenching of bi-beam</a></li><li><a href="../../tutorials/11_adaptivity.html">11. Adaptive mesh refinement</a></li><li><a href="../../tutorials/12_nucleation.html">12. Crack nucleation</a></li><li><a href="../../tutorials/13_traction_separation.html">13. Traction separation law</a></li><li><a href="../../tutorials/14_klexpansion.html">14. Random field generation</a></li><li><a href="../../tutorials/15_mosaic_patches.html">15. Mosaic field generation</a></li></ul><ul class="dropdown-content" id="0f5ee1f3-d866-45ff-978d-64a0215eea29"><li><a href="../../theory/intro.html">Introduction</a></li><li><a href="../../theory/kinematics.html">State variables and kinematics</a></li><li><a href="../../theory/thermodynamics.html">Thermodynamics</a></li><li><a href="../../theory/minimization.html">The minimization problem</a></li><li><a href="../../theory/constitutive_models.html">Constitutive Models</a></li></ul><ul class="dropdown-content" id="f5c5e5f6-2738-43b5-99b9-114089fd6e35"><li><a href="../../modules/index.html">Physics modules</a></li><li><a href="../../syntax/index.html">Complete syntax</a></li><li><a href="../../syntax/raccoon.html">RACCOON syntax</a></li><li><a href="../../syntax/solid_mechanics.html">Solid mechanics syntax</a></li><li><a href="../../syntax/phase_field.html">Phase field syntax</a></li><li><a href="../../syntax/heat_transfer.html">Heat conduction syntax</a></li></ul><ul class="dropdown-content" id="ae65570d-c2d6-4e4d-8147-88ea593035f0"><li><a href="../../getting_started/install.html">Install RACCOON</a></li><li><a href="../../getting_started/update.html">Update RACCOON</a></li><li><a href="../../getting_started/running.html">Running your first model</a></li><li><a href="../../getting_started/paraview.html">Visualization</a></li><li><a href="../../getting_started/ide.html">Code development</a></li><li><a href="../../getting_started/docs.html">Browse the documentation locally</a></li></ul><ul class="dropdown-content" id="9d316d28-3a66-4326-8e60-95f7e37a6527"><li><a href="../../tutorials/01_small_deformation_elasticity.html">1. Small deformation</a></li><li><a href="../../tutorials/02_mode1_brittle_fracture.html">2. Mode-I fracture</a></li><li><a href="../../tutorials/03_mode2_brittle_fracture.html">3. Mode-II fracture</a></li><li><a href="../../tutorials/04_fiber_reinforced_matrix.html">4. Fiber-reinforced matrix</a></li><li><a href="../../tutorials/05_soil_desiccation.html">5. Soil desiccation</a></li><li><a href="../../tutorials/06_large_deformation_elasticity.html">6. Large deformation</a></li><li><a href="../../tutorials/07_elastoplasticity.html">7. Elastoplasticity</a></li><li><a href="../../tutorials/08_ductile_fracture.html">8. Ductile fracture</a></li><li><a href="../../tutorials/09_three_point_bending.html">9. Three-point bending</a></li><li><a href="../../tutorials/10_quenching_bibeam.html">10. Quenching of bi-beam</a></li><li><a href="../../tutorials/11_adaptivity.html">11. Adaptive mesh refinement</a></li><li><a href="../../tutorials/12_nucleation.html">12. Crack nucleation</a></li><li><a href="../../tutorials/13_traction_separation.html">13. Traction separation law</a></li><li><a href="../../tutorials/14_klexpansion.html">14. Random field generation</a></li><li><a href="../../tutorials/15_mosaic_patches.html">15. Mosaic field generation</a></li></ul><ul class="dropdown-content" id="1c8549a2-bd3c-400c-bb4d-5f9bd4b5becb"><li><a href="../../theory/intro.html">Introduction</a></li><li><a href="../../theory/kinematics.html">State variables and kinematics</a></li><li><a href="../../theory/thermodynamics.html">Thermodynamics</a></li><li><a href="../../theory/minimization.html">The minimization problem</a></li><li><a href="../../theory/constitutive_models.html">Constitutive Models</a></li></ul><ul class="dropdown-content" id="3992da72-b12f-46e5-bc1f-4840ad2bc679"><li><a href="../../modules/index.html">Physics modules</a></li><li><a href="../../syntax/index.html">Complete syntax</a></li><li><a href="../../syntax/raccoon.html">RACCOON syntax</a></li><li><a href="../../syntax/solid_mechanics.html">Solid mechanics syntax</a></li><li><a href="../../syntax/phase_field.html">Phase field syntax</a></li><li><a href="../../syntax/heat_transfer.html">Heat conduction syntax</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="gcse-search"></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="moose-content col s12 m12 l12"><section id="8758c792-e1e2-4d73-94c7-d2328f5d7f8a" data-section-level="1" data-section-text="SolutionInvalidity"><h1 id="solutioninvalidity">SolutionInvalidity</h1><section id="221caf73-fb43-4286-9975-38f16be05869" data-section-level="2" data-section-text="Description"><h2 id="description">Description</h2><p>The <a href="SolutionInvalidity.html">SolutionInvalidity</a> object holds solution invalid warning information for MOOSE. This object allows you to mark a solution as &quot;invalid&quot; under certain conditions and output in which objects and how many times the conditions occurs. An invalid solution means that the solution somehow does not satisfy requirements, such as a value being out of the bounds of a correlation.  Solutions are allowed to be invalid <em>during</em> the nonlinear solve, but they are not allowed to be invalid once the solve has converged. A &quot;converged&quot; solution that is marked as invalid will cause MOOSE to behave as if the solution did NOT converge - including cutting back timesteps, etc.</p><p>To declare a solution as &quot;invalid&quot;, use the macro in the following code to mark it. The user can provide a message to describe the reason for invalidity:</p><pre style="max-height:350px;"><code class="language-cpp">  if (_fe_problem.dt() &lt; 1 &amp;&amp; _test_invalid_recover)
    _test_diffusivity /= 2;
  if (_test_diffusivity &gt; _threshold &amp;&amp; _fe_problem.time() &gt; _invalid_after_time)
  {
    if (_flag_solution_warning)
      flagSolutionWarning(&quot;Solution invalid warning!&quot;);
    else
    {
      if (!_test_different_procs || processor_id() == 0)
        flagInvalidSolution(&quot;The diffusivity is greater than the threshold value!&quot;);
      if (!_test_different_procs || comm().size() == 1 || processor_id() == 1)
        flagInvalidSolution(&quot;Extra invalid thing!&quot;);
    }
  }
  _diffusivity[_qp] = _test_diffusivity;
}
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#817ec5e3-5466-4cab-b74b-e05fcbe58d9f">(moose/test/src/materials/NonsafeMaterial.C)</a><p>The <code>flagInvalidSolution</code> macro will mark the solution as not converged when triggered. The <code>flagSolutionWarning</code> will not do so but simply report on the number of warnings encountered.</p><div class="card moose-alert moose-alert-tip"><div class="card-title moose-alert-title"><i class="material-icons moose-inline-icon">school</i><span class="moose-alert-title-brand">tip</span></div><div class="card-content"><div class="moose-alert-content"><p>It is recommended to have a unique message for each invalidity, especially when you want to mark multiple types of invalid solutions within one object.</p></div></div></div><p>If any solution invalidity is detected during the solve, a summary table of solution invalid warnings will be generated and reported at the end of each time step. An example of this output is shown below:</p><pre style="max-height:350px;"><code class="language-text">
Solution Invalid Warnings:
---------------------------------------------------------------------------------------------------------
|     Object      | Converged | Timestep | Total |                        Message                       |
---------------------------------------------------------------------------------------------------------
| NonsafeMaterial |        16 |       48 |    48 | The diffusivity is greater than the threshold value! |
| NonsafeMaterial |        16 |       48 |    48 | Extra invalid thing!                                 |
---------------------------------------------------------------------------------------------------------
</code></pre><ol class="browser-default" start="1"><li><p><em>Object</em>: shows the MOOSE object name registered for the solution invalid detection and an optional description </p></li><li><p><em>Converged</em>: shows the number of solution invalid warnings for the latest iteration, at convergence </p></li><li><p><em>Timestep</em>: shows the number of solution invalid warnings for the latest time step over all iterations </p></li><li><p><em>Total</em>: shows the total number of solution invalid warnings for the entire simulation </p></li><li><p><em>Message</em>: shows the description of the solution invalidity</p></li></ol><p>When the solution is converged, the number of solution invalid warnings is reported for the latest iteration (linear/nonlinear), the last time step (over all solver iterations) and the entire simulation. SolutionInvalidity warnings can come from numerous objects, some executed once and some executed on every quadrature point. The number of occurrences reported reflects this.</p><p>This Solution Invalid Warnings table can be silenced by setting <a href="#859e17c2-55a7-455b-b269-dd85a626254a" class="moose-modal-link modal-trigger">&quot;allow_invalid_solution&quot;</a> to &#x27;true&#x27;. Then the converged solution will be accepted even if there are still solution invalid warnings, but a message will be generated at the end of the calculation as a reminder:</p><pre style="max-height:350px;"><code class="language-text">
*** Warning ***
The Solution Invalidity warnings are detected but silenced! Use Problem/show_invalid_solution_console=true to show invalid solution counts
</code></pre><p>The Solution Invalid Warning can also be printed out immediately after it is detected by setting <a href="#9dbab138-7ad8-492b-91ab-f7622f85d04d" class="moose-modal-link modal-trigger">&quot;immediately_print_invalid_solution&quot;</a> to <code>true</code>.</p><p></p></section></section><div class="moose-modal modal" id="817ec5e3-5466-4cab-b74b-e05fcbe58d9f"><div class="modal-content"><h4>(moose/test/src/materials/NonsafeMaterial.C)</h4><pre style="max-height:350px;"><code class="language-cpp">// This file is part of the MOOSE framework
// https://mooseframework.inl.gov
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#include &quot;NonsafeMaterial.h&quot;
#include &quot;MooseApp.h&quot;

registerMooseObject(&quot;MooseTestApp&quot;, NonsafeMaterial);

InputParameters
NonsafeMaterial::validParams()
{
  InputParameters params = Material::validParams();

  params.addRequiredParam&lt;Real&gt;(&quot;diffusivity&quot;, &quot;The diffusivity value.&quot;);
  params.addParam&lt;Real&gt;(
      &quot;threshold&quot;,
      0,
      &quot;This value sets the upper limit for the validity of the material property value.&quot;);
  params.addParam&lt;bool&gt;(&quot;test_different_procs&quot;,
                        false,
                        &quot;True to test setting invalid solutions on different processors&quot;);
  params.addParam&lt;bool&gt;(&quot;test_invalid_recover&quot;, false, &quot;True to test invalid solutions recover&quot;);
  params.addParam&lt;Real&gt;(&quot;invalid_after_time&quot;,
                        -std::numeric_limits&lt;Real&gt;::max(),
                        &quot;Only set invalid solutions after this time&quot;);
  params.addParam&lt;bool&gt;(
      &quot;flag_solution_warning&quot;,
      false,
      &quot;True to test an invalid solution warning, which do not cause the solution to be invalid.&quot;);

  return params;
}

NonsafeMaterial::NonsafeMaterial(const InputParameters &amp; parameters)
  : Material(parameters),
    _input_diffusivity(getParam&lt;Real&gt;(&quot;diffusivity&quot;)),
    _threshold(getParam&lt;Real&gt;(&quot;threshold&quot;)),
    _diffusivity(declareProperty&lt;Real&gt;(&quot;diffusivity&quot;)),
    _test_different_procs(getParam&lt;bool&gt;(&quot;test_different_procs&quot;)),
    _test_invalid_recover(getParam&lt;bool&gt;(&quot;test_invalid_recover&quot;)),
    _invalid_after_time(getParam&lt;Real&gt;(&quot;invalid_after_time&quot;)),
    _flag_solution_warning(getParam&lt;bool&gt;(&quot;flag_solution_warning&quot;))
{
}

void
NonsafeMaterial::computeQpProperties()
{
  Real _test_diffusivity = _input_diffusivity;
  // Gradually modify diffusivity value to test solution invalid recover
  if (_fe_problem.dt() &lt; 1 &amp;&amp; _test_invalid_recover)
    _test_diffusivity /= 2;
  if (_test_diffusivity &gt; _threshold &amp;&amp; _fe_problem.time() &gt; _invalid_after_time)
  {
    if (_flag_solution_warning)
      flagSolutionWarning(&quot;Solution invalid warning!&quot;);
    else
    {
      if (!_test_different_procs || processor_id() == 0)
        flagInvalidSolution(&quot;The diffusivity is greater than the threshold value!&quot;);
      if (!_test_different_procs || comm().size() == 1 || processor_id() == 1)
        flagInvalidSolution(&quot;Extra invalid thing!&quot;);
    }
  }
  _diffusivity[_qp] = _test_diffusivity;
}
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="859e17c2-55a7-455b-b269-dd85a626254a"><div class="modal-content"><h4>allow_invalid_solution</h4><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Set to true to allow convergence even though the solution has been marked as 'invalid'</p></div></div><div class="moose-modal modal" id="9dbab138-7ad8-492b-91ab-f7622f85d04d"><div class="modal-content"><h4>immediately_print_invalid_solution</h4><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Whether or not to report invalid solution warnings at the time the warning is produced instead of after the calculation</p></div></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="https://cse.google.com/cse.js?cx=008852834041008754713:g3ilnhhbbj9"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>